<!-- ojm remove m-policyForm__container" -->
<ng-container *ngIf="!(loading$ | async); else loadingSpinnerTemplate">
  <div class="m-formWrapper">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- -------------------- -->
      <!-- POLICY SELECTION RADIO -->
      <!-- -------------------- -->
      <div class="m-form__fieldsContainer">
        <div class="m-form__field--radio">
          <label
            class="m-form__row--label m-policyForm__label--secondary"
            i18n="@@POLICY_FORM__FIELD_LABEL__SELECTION"
            >{{ policyName | capitalizeFirst }} selection</label
          >
          <!-- --Default------------------ -->
          <div class="m-form__row--input">
            <label
              for="policyImplementation--default"
              class="m-form__customInputWrapper__radio"
            >
              <ng-container i18n="@@POLICY_FORM__DEFAULT_IMPLEMENTATION"
                >Default {{ policyName }}</ng-container
              >
              <input
                type="radio"
                id="policyImplementation--default"
                formControlName="policyImplementation"
                [value]="CustomPolicyImplementation.DEFAULT"
                data-ref="policy-form-radio-selection-default"
              />
              <span class="m-form__customInput__radio"></span>
            </label>
          </div>
          <!--Custom-------------------- -->
          <div class="m-form__row--input">
            <label
              for="policyImplementation--custom"
              class="m-form__customInputWrapper__radio"
            >
              <ng-container i18n="@@POLICY_FORM__CUSTOM_IMPLEMENTATION"
                >Custom {{ policyName }}</ng-container
              >
              <input
                type="radio"
                id="policyImplementation--custom"
                formControlName="policyImplementation"
                [value]="CustomPolicyImplementation.CUSTOM"
                data-ref="policy-form-radio-selection-custom"
              />
              <span class="m-form__customInput__radio"></span>
            </label>
          </div>
          <!--External link-------------------- -->
          <div class="m-form__row--input">
            <label
              for="policyImplementation--external"
              class="m-form__customInputWrapper__radio"
            >
              <ng-container i18n="@@POLICY_FORM__EXTERNAL_IMPLEMENTATION"
                >Link to external {{ policyName }}</ng-container
              >
              <input
                type="radio"
                id="policyImplementation--external"
                formControlName="policyImplementation"
                [value]="CustomPolicyImplementation.EXTERNAL"
                data-ref="policy-form-radio-selection-external-link"
              />
              <span class="m-form__customInput__radio"></span>
            </label>
          </div>
        </div>
      </div>
      <div class="m-form__fieldsContainer">
        <!-- -------------------- -->
        <!-- REVIEW DEFAULT LINK  -->
        <!-- -------------------- -->
        <ng-container *ngIf="showDefaultLink">
          <div
            class="m-form__row--label m-policyForm__label--secondary m-policyForm__label--reviewDefault"
          >
            <label
              >Review the <a href="todoojm">default</a> {{ policyName }}</label
            >
          </div>
        </ng-container>
        <!-- -------------------- -->
        <!-- CUSTOM POLICY TEXTAREA   -->
        <!-- -------------------- -->
        <ng-container *ngIf="showPolicyText">
          <div class="m-form__field--text stretchedField hasValidationRow">
            <div class="m-form__row--label m-policyForm__label--secondary">
              <label i18n="@@POLICY_FORM__CUSTOM_POLICY_LABEL"
                >Custom {{ policyName }}</label
              >
            </div>
            <div
              class="m-form__row--input"
              [ngClass]="{
                invalid: form.get('policyText').errors?.maxlength
              }"
            >
              <textarea
                formControlName="policyText"
                required
                autocomplete="off"
                data-ref="policy-form-policy-text-input"
              ></textarea>
            </div>
            <!--Error: max length exceeded -------------------- -->
            <div class="m-form__row--validation">
              <p
                *ngIf="form.get('policyText').errors?.maxlength"
                i18n="@@POLICY_FORM__POLICY_TEXT_MAX_LENGTH_ERROR"
              >
                Maximum {{ policyTextMaxLength }} characters allowed.
              </p>
            </div>
          </div>
        </ng-container>
        <!-- -------------------- -->
        <!-- EXTERNAL LINK INPUT -->
        <!-- -------------------- -->
        <ng-container *ngIf="showExternalLink">
          <div class="m-form__field--text stretchedField hasValidationRow">
            <div class="m-form__row--label m-policyForm__label--secondary">
              <label i18n="@@POLICY_FORM__EXTERNAL_LINK_LABEL"
                >External link</label
              >
            </div>
            <div
              class="m-form__row--input"
              [ngClass]="{
                invalid:
                  form.get('externalLink').touched &&
                  form.get('externalLink').errors?.invalidUrl
              }"
            >
              <input
                type="text"
                formControlName="externalLink"
                class="form-control"
                required
                data-ref="policy-form-external-link-input"
              />
            </div>
            <!--Error: Invalid url -------------------- -->
            <div class="m-form__row--validation">
              <p
                *ngIf="
                  form.get('externalLink').touched &&
                  form.get('externalLink').errors?.invalidUrl
                "
                i18n="@@POLICY_FORM__INVALID_URL_ERROR"
              >
                Please enter a valid URL, including the 'http://' or 'https://'
                prefix.
              </p>
            </div>
          </div>
        </ng-container>

        <!-- ojm look into this -->
        <!-- <m-formError
        *ngIf="communityGuidelinesFormControl?.dirty"
        [errors]="communityGuidelinesFormControl?.errors"
      >
      </m-formError> -->
      </div>

      <!-- -------------------- -->
      <!-- BUTTON  -->
      <!-- -------------------- -->
      <div class="m-form__buttonsContainer">
        <m-button
          *ngIf="{
            inProgress: savingInProgress$ | async
          } as buttonTemplateVariables"
          [disabled]="
            !form.valid || !form.dirty || buttonTemplateVariables.inProgress
          "
          [saving]="buttonTemplateVariables.inProgress"
          color="blue"
          (onAction)="onSubmit()"
          data-ref="policy-form-submit-button"
        >
          <ng-container i18n="@@COMMON__SAVE">Save</ng-container>
        </m-button>
      </div>
    </form>
  </div>
</ng-container>
<!-- -------------------- -->

<ng-template #loadingSpinnerTemplate>
  <m-loadingSpinner [inProgress]="true"></m-loadingSpinner>
</ng-template>
