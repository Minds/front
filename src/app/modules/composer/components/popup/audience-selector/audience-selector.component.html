<div class="m-composerPopup__body">
  <div class="m-composerPopup__content">
    <h3
      class="m-composerPopup__title"
      i18n="@@COMPOSER_AUDIENCE_SELECTOR__CHOOSE_AUDIENCE"
    >
      Choose audience
    </h3>

    <div class="m-composerAudience__myChannelContainer">
      <m-selectableEntityCard
        [entity]="loggedInUser"
        (click)="onEntitySelect(null)"
        [selected]="(selectedAudience$ | async)?.guid === null"
      ></m-selectableEntityCard>
    </div>

    <h4 class="m-composerPopup__subtitle" (click)="toggleGroupsExpand()">
      My Groups
      <ng-container *ngIf="groupsExpanded$ | async; else collapsedTemplate">
        <span class="material-icons">expand_more</span>
      </ng-container>
      <ng-template #collapsedTemplate>
        <span class="material-icons">chevron_right</span>
      </ng-template>
    </h4>

    <div
      *ngIf="groupsExpanded$ | async"
      class="m-composerAudience__groupsList"
      #scrollSource
    >
      <ng-container *ngFor="let group of groups$ | async">
        <m-selectableEntityCard
          [entity]="group"
          (click)="onEntitySelect(group)"
          [selected]="(selectedAudience$ | async)?.guid === group.guid"
        ></m-selectableEntityCard>
      </ng-container>
      <infinite-scroll
        *ngIf="
          (groups$ | async) &&
          (groups$ | async).length > 0 &&
          (groupsHasNext$ | async)
        "
        (load)="loadNextGroups()"
        [inProgress]="groupsLoadInProgress$ | async"
        [hidden]="groupsLoadInProgress$ | async"
        [scrollSource]="scrollSource"
        [moreData]="groupsHasNext$ | async"
        [distance]="'50%'"
      ></infinite-scroll>
    </div>
  </div>

  <div class="m-composerPopup__action">
    <m-button
      class="m-composerPopup__save"
      (onAction)="save()"
      data-ref="nsfw-save-button"
      i18n="@@COMMON__SAVE"
      >Save</m-button
    >
  </div>
</div>
