<div class="m-pro__settings">
  <div class="m-toolbar" *ngIf="settings">
    <div class="m-topbar--row">
      <div class="m-topbar--navigation m-topbar--navigation--text-only">
        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'general'"
          (click)="currentTab = 'general'"
        >
          <span i18n>General</span>
          <m-tooltip icon="help" i18n>
            Customize your title and headline.
          </m-tooltip>
        </a>

        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'theme'"
          (click)="currentTab = 'theme'"
        >
          <span i18n>Theme</span>
          <m-tooltip icon="help" i18n>
            Set up your color scheme.
          </m-tooltip>
        </a>

        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'assets'"
          (click)="currentTab = 'assets'"
        >
          <span i18n>Assets</span>
          <m-tooltip icon="help" i18n>
            Upload a custom logo and background.
          </m-tooltip>
        </a>

        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'hashtags'"
          (click)="currentTab = 'hashtags'"
        >
          <span i18n>Hashtags</span>
          <m-tooltip icon="help" i18n>
            Set up category filters using hashtags.
          </m-tooltip>
        </a>

        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'footer'"
          (click)="currentTab = 'footer'"
        >
          <span i18n>Footer</span>
          <m-tooltip icon="help" i18n>
            Set up site footer items.
          </m-tooltip>
        </a>

        <a
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'domain'"
          (click)="currentTab = 'domain'"
        >
          <span i18n>Domain</span>
          <m-tooltip icon="help" i18n>
            Configure your custom domain.
          </m-tooltip>
        </a>

        <a
          *ngIf="!isRemote"
          class="m-topbar--navigation--item"
          [class.m-topbar--navigation--item-active]="currentTab === 'cancel'"
          (click)="currentTab = 'cancel'"
        >
          <span i18n>Cancel</span>
          <m-tooltip icon="help" i18n>
            Cancel your Pro subscription.
          </m-tooltip>
        </a>
      </div>
    </div>
  </div>

  <div class="m-page">
    <div class="m-page--main m-proSettings__page m-border">
      <div *ngIf="inProgress && !settings">
        <div class="mdl-spinner mdl-js-spinner is-active" [mdl]></div>
      </div>

      <ng-container *ngIf="settings">
        <form (ngSubmit)="save()">
          <ng-container [ngSwitch]="currentTab">
            <!-- General -->

            <ng-template ngSwitchCase="general">
              <p class="m-proSettings__note" i18n>
                Customize your title and headline. This will be used as your SEO
                tags as well.
              </p>

              <div class="m-proSettings__field">
                <label for="title" i18n>Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  [(ngModel)]="settings.title"
                />
              </div>

              <div class="m-proSettings__field">
                <label for="headline" i18n>Headline (can be multi-line)</label>
                <textarea
                  id="headline"
                  name="headline"
                  [(ngModel)]="settings.headline"
                ></textarea>
              </div>

              <div class="m-proSettings__field">
                <label for="publish" i18n style="display: inline"
                  >Enable PRO theme for Channel</label
                >
                <input
                  type="checkbox"
                  id="publish"
                  name="publish"
                  [(ngModel)]="settings.published"
                />
              </div>
            </ng-template>

            <!-- Theme -->

            <ng-template ngSwitchCase="theme">
              <p class="m-proSettings__note" i18n>
                Set up your color scheme below.
              </p>

              <div class="m-proSettings__field">
                <label for="text_color" i18n>Text Color</label>
                <input
                  type="color"
                  id="text_color"
                  name="text_color"
                  [(ngModel)]="settings.text_color"
                />
              </div>

              <div class="m-proSettings__field">
                <label for="primary_color" i18n>Primary Color</label>
                <input
                  type="color"
                  id="primary_color"
                  name="primary_color"
                  [(ngModel)]="settings.primary_color"
                />
              </div>

              <div class="m-proSettings__field">
                <label for="plain_background_color" i18n>
                  Plain Background Color
                </label>
                <input
                  type="color"
                  id="plain_background_color"
                  name="plain_background_color"
                  [(ngModel)]="settings.plain_background_color"
                />
              </div>

              <div class="m-proSettings__field">
                <label i18n>
                  Color Schema
                </label>

                <input
                  type="radio"
                  id="scheme_light"
                  name="scheme"
                  value="light"
                  [(ngModel)]="settings.scheme"
                />
                <label for="scheme_light" class="m-proSettings__inlineLabel">
                  Light
                </label>

                <input
                  type="radio"
                  id="scheme_dark"
                  name="scheme"
                  value="dark"
                  [(ngModel)]="settings.scheme"
                />
                <label for="scheme_dark" class="m-proSettings__inlineLabel">
                  Dark
                </label>
              </div>

              <div class="m-proSettings__field">
                <label i18n>Tiles Aspect Ratio</label>

                <ng-container *ngFor="let ratio of ratios">
                  <input
                    type="radio"
                    [id]="'tile_ratio_' + ratio"
                    name="tile_ratio"
                    [value]="ratio"
                    [(ngModel)]="settings.tile_ratio"
                  />
                  <label
                    [for]="'tile_ratio_' + ratio"
                    class="m-proSettings__inlineLabel"
                  >
                    {{ ratio }}
                  </label>
                </ng-container>
              </div>
            </ng-template>

            <!-- Assets -->

            <ng-template ngSwitchCase="assets">
              <p class="m-proSettings__note" i18n>
                Upload a custom logo and background.
              </p>

              <div class="m-proSettings__field">
                <label for="logo" i18n>Logo Image</label>

                <label
                  for="logo"
                  class="m-proSettingsField__filePreview m-proSettingsField__logoFilePreview"
                  [ngStyle]="{
                    backgroundColor: settings.plain_background_color
                  }"
                >
                  <input
                    type="file"
                    id="logo"
                    name="logo"
                    accept="image/*"
                    (change)="onAssetFileSelect('logo', logoField.files)"
                    #logoField
                  />

                  <img
                    *ngIf="getPreviewAssetSrc('logo')"
                    [src]="getPreviewAssetSrc('logo')"
                  />

                  <span class="m-proSettingsFieldFilePreview__overlay">
                    <i class="material-icons">cloud_upload</i>
                  </span>
                </label>
              </div>

              <div class="m-proSettings__field">
                <label for="background" i18n>Background</label>

                <label
                  for="background"
                  class="m-proSettingsField__filePreview m-proSettingsField__backgroundFilePreview"
                >
                  <input
                    type="file"
                    id="background"
                    name="background"
                    accept="image/*"
                    (change)="
                      onAssetFileSelect('background', backgroundField.files)
                    "
                    #backgroundField
                  />

                  <img
                    *ngIf="getPreviewAssetSrc('background')"
                    [src]="getPreviewAssetSrc('background')"
                  />

                  <span class="m-proSettingsFieldFilePreview__overlay">
                    <i class="material-icons">cloud_upload</i>
                  </span>
                </label>
              </div>
            </ng-template>

            <!-- Tags -->

            <ng-template ngSwitchCase="hashtags">
              <p class="m-proSettings__note" i18n>
                Set up your category filter hashtags here.
              </p>

              <m-draggable-list [data]="settings.tag_list" [id]="'tag'">
                <ng-template let-tag="item" let-i="i">
                  <div class="m-proSettings__field">
                    <label i18n> Hashtag #{{ i + 1 }} </label>

                    <div class="m-proSettings__flexInputs">
                      <input
                        type="text"
                        placeholder="Label"
                        [id]="'tag-label-' + i"
                        [name]="'tag[' + i + '][label]'"
                        [(ngModel)]="tag.label"
                      />

                      <input
                        type="text"
                        placeholder="#hashtag"
                        [id]="'tag-tag-' + i"
                        [name]="'tag[' + i + '][tag]'"
                        [(ngModel)]="tag.tag"
                      />

                      <i class="material-icons" (click)="removeTag(i)">
                        clear
                      </i>
                    </div>
                  </div>
                </ng-template>
              </m-draggable-list>

              <div class="m-proSettings__field">
                <button
                  class="m-btn m-btn--slim"
                  type="button"
                  [disabled]="inProgress"
                  (click)="addBlankTag()"
                  i18n
                >
                  + Add Tag
                </button>
              </div>
            </ng-template>

            <!-- Footer -->

            <ng-template ngSwitchCase="footer">
              <p class="m-proSettings__note" i18n>
                Set up your footer links below.
              </p>

              <div class="m-proSettings__field">
                <label for="footer_text" i18n>Text</label>
                <input
                  type="text"
                  id="footer_text"
                  name="footer_text"
                  [(ngModel)]="settings.footer_text"
                />
              </div>

              <m-draggable-list [data]="settings.footer_links" [id]="'title'">
                <ng-template let-link="item" let-i="i">
                  <div class="m-proSettings__field">
                    <label i18n> Link #{{ i + 1 }} </label>

                    <div class="m-proSettings__flexInputs">
                      <input
                        type="text"
                        placeholder="Title"
                        [id]="'footer_link-title-' + i"
                        [name]="'footer_link[' + i + '][title]'"
                        [(ngModel)]="link.title"
                      />

                      <input
                        type="text"
                        placeholder="https://example.com/"
                        [id]="'footer_link-href-' + i"
                        [name]="'footer_link[' + i + '][href]'"
                        [(ngModel)]="link.href"
                      />

                      <i class="material-icons" (click)="removeFooterLink(i)">
                        clear
                      </i>
                    </div>
                  </div>
                </ng-template>
              </m-draggable-list>

              <div class="m-proSettings__field">
                <button
                  class="m-btn m-btn--slim"
                  type="button"
                  [disabled]="inProgress"
                  (click)="addBlankFooterLink()"
                  i18n
                >
                  + Add Link
                </button>
              </div>
            </ng-template>

            <!-- Domain -->

            <ng-template ngSwitchCase="domain">
              <p class="m-proSettings__note" i18n>
                Customize your domain and setup your HTTPS certificates.
              </p>

              <div class="m-proSettings__field">
                <label for="domain" i18n>Domain</label>

                <input
                  class="m-proSettingsField__input--hasIcon"
                  type="text"
                  id="domain"
                  name="domain"
                  [(ngModel)]="settings.domain"
                  (keydown)="domainValidationSubject.next($event)"
                />

                <m-tooltip
                  *ngIf="isDomainValid !== null"
                  [icon]="isDomainValid ? 'check' : 'close'"
                  class="m-proSettingsDomain__validIcon"
                  [class.m-proSettingsDomain__validIcon--true]="isDomainValid"
                  [class.m-proSettingsDomain__validIcon--false]="!isDomainValid"
                >
                  <ng-container *ngIf="isDomainValid; else notValidDomain" i18n>
                    This domain is available
                  </ng-container>
                  <ng-template #notValidDomain>
                    <ng-container i18n>
                      This domain is taken
                    </ng-container>
                  </ng-template>
                </m-tooltip>
              </div>

              <div class="m-proSettings__field">
                <label for="custom_head" i18n>Custom &lt;head&gt; Code</label>
                <textarea
                  class="m-proSettings__codeTextarea"
                  id="custom_head"
                  name="custom_head"
                  [(ngModel)]="settings.custom_head"
                  [readOnly]="!isAdmin"
                ></textarea>

                <p *ngIf="!isAdmin" class="m-proSettings__note" i18n>
                  In order to customize this field, please contact a Minds admin
                  or email info@minds.com.
                </p>
              </div>
            </ng-template>

            <!-- Cancel -->

            <ng-template ngSwitchCase="cancel">
              <p class="m-proSettings__note" i18n>
                Clicking the button below will take you to Minds Pro page, where
                you can cancel your subscription.
              </p>

              <div class="m-proSettings__field">
                <a
                  class="m-btn m-link-btn m-btn--slim m-btn--destructive"
                  routerLink="/pro"
                  >Cancel Pro</a
                >
              </div>
            </ng-template>
          </ng-container>

          <div class="m-proSettings__error" *ngIf="error">
            Error: {{ error }}
          </div>

          <div
            class="m-proSettings__field m-proSettings__fieldActions"
            *ngIf="currentTab !== 'cancel'"
          >
            <button
              class="m-btn m-btn--slim m-btn--action"
              type="submit"
              [disabled]="inProgress"
              i18n
            >
              Save
            </button>

            <div class="m-proSettings__fieldSpinner" *ngIf="inProgress">
              <div class="mdl-spinner mdl-js-spinner is-active" [mdl]></div>
            </div>

            <a
              class="m-btn m-link-btn m-btn--slim m-proSettings__previewBtn"
              [routerLink]="previewRoute"
              i18n
              >View your Pro channel</a
            >
          </div>
        </form>
      </ng-container>
    </div>
  </div>
</div>
