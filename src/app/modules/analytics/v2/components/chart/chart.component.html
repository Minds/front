<!-- TODO: Make this into a different component -->

<!-- TODO: then all this becomes m-plotlyChart -->
<div
  #chartContainer
  class="m-analyticsChart__chartContainer"
  [ngClass]="{ isTouchDevice: isTouchDevice }"
>
  <plotly-plot
    *ngIf="init"
    #graphDiv
    id="graphDiv"
    [data]="data"
    [layout]="layout"
    [config]="config"
    [style]="{ position: 'relative' }"
    [useResizeHandler]="true"
    (hover)="onHover($event)"
    (unhover)="onUnhover($event)"
    (plotly_click)="onClick($event)"
  >
  </plotly-plot>
</div>

<div #hoverInfoDiv id="hoverInfoDiv" class="m-analyticsChart__hoverInfoDiv">
  <i *ngIf="isTouchDevice" class="material-icons" (click)="onUnhover($event)"
    >close</i
  >
  <div class="m-analyticsChart__hoverInfo__row">
    {{ hoverInfo.date | utcDate | date: datePipe }}
  </div>
  <div
    [ngSwitch]="selectedMetric?.unit"
    class="m-analyticsChart__hoverInfo__row--primary"
  >
    <ng-template ngSwitchCase="number">
      {{ hoverInfo.value | number }} {{ selectedMetric.label | lowercase }}
    </ng-template>
    <ng-template ngSwitchCase="usd">
      {{ hoverInfo.value | currency }} USD
    </ng-template>
    <ng-template ngSwitchDefault>
      {{ hoverInfo.value | number: '1.1-3' }} {{ selectedMetric?.unit }}
    </ng-template>
  </div>
  <div class="m-analyticsChart__hoverInfo__row" *ngIf="isComparison">
    vs
    <ng-container
      [ngSwitch]="selectedMetric?.unit"
      class="m-analyticsChart__hoverInfo__row"
    >
      <ng-template ngSwitchCase="number">
        {{ hoverInfo.comparisonValue | number }}
      </ng-template>
      <ng-template ngSwitchCase="usd">
        {{ hoverInfo.comparisonValue | currency }}
      </ng-template>
      <ng-template ngSwitchDefault>
        {{ hoverInfo.comparisonValue | number: '1.1-3' }}
      </ng-template>
    </ng-container>
    on {{ hoverInfo.comparisonDate | utcDate | date: datePipe }}
  </div>
</div>
