<div class="mf-jumpAnchor" #topAnchor></div>

<m-loadingSpinner [inProgress]="loading"></m-loadingSpinner>

<m-marketing *ngIf="!loading" class="m-plus__marketing">
  <div class="m-marketing__main m-marketing__section--style-2">
    <div class="m-grid m-marketing__wrapper">
      <div class="m-grid__column-7 m-grid__column-12--mobile m-marketing__body">
        <h1 *ngIf="data?.hero?.h1">{{ data.hero.h1 }}</h1>
        <markdown
          ngPreserveWhitespaces
          *ngIf="data?.hero?.body"
          class="m-marketing__description"
          >{{ data.hero.body }}</markdown
        >

        <div class="m-plusMarketing__subscription">
          <m-plus--subscription
            (onEnable)="detectChanges()"
            (onDisable)="detectChanges()"
          ></m-plus--subscription>
        </div>

        <div class="m-plusMarketing__verify" *ngIf="isPlus">
          <i
            class="material-icons"
            [class.m-plusMarketingVerify__verifiedIcon]="isVerified"
            [class.m-plusMarketingVerify__unverifiedIcon]="!isVerified"
            >verified_user</i
          >

          <ng-container *ngIf="!isVerified; else alreadyVerifiedView">
            <a
              (click)="openVerifyModal()"
              i18n="@@MARKETING_PLUS__CLICK_TO_REQUEST_VERIFICATION"
              >Click here to request to be verified</a
            >
          </ng-container>

          <ng-template #alreadyVerifiedView>
            <span i18n="@@MARKETING_PLUS__YOU_ARE_VERIFIED"
              >You are verified!</span
            >
          </ng-template>
        </div>
      </div>

      <div
        class="
          m-grid__column-5 m-grid__column-12--mobile
          m-marketing__image m-marketing__imageContainer
        "
      >
        <span
          [ngClass]="{
            'm-marketing__imageSpan--noBackgroundEffects': !data.hero
              ?.showBackgroundEffects
          }"
        >
          <img
            *ngIf="data?.hero?.image?.data?.attributes?.url"
            [src]="strapiUrl + data.hero.image.data.attributes.url"
            class="m-marketing__image--tall"
            alt="Minds Plus"
          />
        </span>
      </div>
    </div>
  </div>

  <ng-container slot="2">
    <m-marketing__asFeaturedIn></m-marketing__asFeaturedIn>

    <div *ngFor="let sectionData of data?.sections">
      <m-marketing__generalSection
        [leftAligned]="sectionData.leftAligned"
        [title]="sectionData.title"
        [body]="sectionData.body"
        [imageUrl]="
          sectionData.image?.data?.attributes?.url
            ? strapiUrl + sectionData.image?.data?.attributes?.url
            : null
        "
        [imageOverlayUrl]="
          sectionData.imageOverlay?.data?.attributes?.url
            ? strapiUrl + sectionData.imageOverlay?.data?.attributes?.url
            : null
        "
        [actionButtons]="sectionData.actionButtons"
        [showBodyBackground]="sectionData.showBodyBackground"
        [showBackgroundEffects]="sectionData.showBackgroundEffects"
      ></m-marketing__generalSection>
    </div>

    <!-- Final section -->
    <div class="m-marketing__section m-marketing__section--tail">
      <m-marketing__otherFeaturesSection
        *ngIf="data?.otherFeaturesSection"
        [title]="data.otherFeaturesSection?.title ?? null"
        [column1Title]="data.otherFeaturesSection?.column1Title"
        [column1Body]="data.otherFeaturesSection?.column1Body"
        [column2Title]="data.otherFeaturesSection?.column2Title"
        [column2Body]="data.otherFeaturesSection?.column2Body"
        [column3Title]="data.otherFeaturesSection?.column3Title"
        [column3Body]="data.otherFeaturesSection?.column3Body"
      ></m-marketing__otherFeaturesSection>

      <div
        *ngIf="data?.sectionTail?.actionButton"
        class="m-grid m-marketing__wrapper"
      >
        <div
          class="
            m-grid__column-12 m-grid__column-12--mobile
            m-marketing__body m-marketing__body--extra
          "
        >
          <a
            *ngIf="
              data.sectionTail.actionButton.navigationUrl;
              else predefinedActionTemplate
            "
            [href]="data.sectionTail.actionButton.navigationUrl"
            [attr.data-ref]="data.sectionTail.actionButton.dataRef ?? null"
            target="_blank"
          >
            <m-button color="blue">{{
              data.sectionTail.actionButton.text
            }}</m-button>
          </a>
          <ng-template #predefinedActionTemplate>
            <m-button
              color="blue"
              (onAction)="resolveAction(data.sectionTail.actionButton.action ?? null)"
              [attr.data-ref]="data.sectionTail.actionButton.dataRef ?? null"
            >
              {{ data.sectionTail.actionButton.text }}
            </m-button>
          </ng-template>
        </div>
      </div>
    </div>
  </ng-container>
</m-marketing>
