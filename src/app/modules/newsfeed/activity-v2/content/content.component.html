<!-- ----------------------------------- -->
<!-- PAYWALL -->
<!-- ----------------------------------- -->
<ng-container *mIfFeature="'paywall-2020'">
  <ng-container *ngIf="!hideMedia">
    <m-activityV2__paywall
      *ngIf="service.shouldShowPaywall$ | async"
      [mediaHeight]="mediaHeight"
      [mediaWidth]="mediaWidth"
      class="isPaywall2020"
    ></m-activityV2__paywall
  ></ng-container>
</ng-container>
<!-- ----------------------------------- -->
<!-- TEXT (WHEN TEXT ON TOP)-->
<!-- ----------------------------------- -->
<ng-container *ngIf="!isTextBelowMedia">
  <ng-container *ngTemplateOutlet="textTemplate"></ng-container>
</ng-container>
<!-- ----------------------------------- -->
<!-- RICH EMBED / BLOG -->
<!-- ----------------------------------- -->
<ng-container *ngIf="!hideMedia">
  <div class="m-activityContent__media--richEmbed" *ngIf="isRichEmbed">
    <div class="m-activityContent__fixedHeightSpacer"></div>
    <minds-rich-embed
      (mediaModalRequested)="onModalRequested($event)"
      [src]="entity"
      [maxheight]="isModal ? null : 320"
      [isModal]="isModal"
      [activityV2Feature]="true"
      [displayAsColumn]="
        service.displayOptions.minimalMode ||
        service.displayOptions.isModal ||
        service.displayOptions.showBoostRotatorButtons
      "
    >
    </minds-rich-embed>
    <div class="m-activityContent__fixedHeightSpacer" *ngIf="!bodyText"></div>
  </div>
  <!-- ----------------------------------- -->
  <!-- VIDEO -->
  <!-- ----------------------------------- -->
  <div
    class="m-activityContent__media--video m-activityContent__media"
    #videoEl
    *ngIf="isVideo"
    [ngClass]="{
      isPaywall: service.shouldShowPaywall$ | async,
      'm-activityContent__media--video--modal': isModal
    }"
  >
    <div class="m-activityContent__fixedHeightSpacer"></div>

    <m-videoPlayer--scrollaware
      [guid]="videoGuid"
      [shouldPlayInModal]="!isModal"
      (mediaModalRequested)="onModalRequested($event)"
      [autoplay]="
        service.displayOptions.autoplayVideo &&
        !(service.shouldShowPaywall$ | async)
      "
      [style.height]="isModal ? null : videoHeight"
      [isModal]="isModal"
      [style.overflow]="videoHeight && !isModal ? 'hidden' : null"
    ></m-videoPlayer--scrollaware>

    <div class="m-activityContent__fixedHeightSpacer"></div>
  </div>
  <!-- ----------------------------------- -->
  <!-- IMAGE -->
  <!-- ----------------------------------- -->
  <div
    class="m-activityContent__media--image m-activityContent__media"
    #imageEl
    *ngIf="isImage"
    [ngClass]="{
      'm-activityContent__media--extraTallImage':
        extraTallImage &&
        (service.displayOptions.isFeed || service.displayOptions.minimalMode),
      'm-activityContent__media--extraWideImage':
        extraWideImage && service.displayOptions.isFeed
    }"
  >
    <ng-container *ngIf="!isModal; else image">
      <a
        class="m-activityContentMedia__link"
        [routerLink]="['/newsfeed', imageGuid]"
        (click)="onModalRequested($event)"
      >
        <div
          *ngIf="
            (extraTallImage || extraWideImage) && service.displayOptions.isFeed
          "
          class="m-activityContentMedia__expandIcon"
          (click)="onModalRequested($event)"
        >
          <m-icon iconId="crop_free" sizeFactor="25"></m-icon>
        </div>
        <ng-container [ngTemplateOutlet]="image"></ng-container
      ></a>
    </ng-container>

    <ng-template #image
      ><img
        [src]="imageUrl"
        (error)="onImageError($event)"
        (click)="onModalRequested($event)"
        [m-blurhash]="service.entity$ | async"
        [paywalled]="service.shouldShowPaywall$ | async"
        [style.object-fit]="
          (service.shouldShowPaywall$ | async) ? 'cover' : undefined
        "
        [style.height]="service.displayOptions.isModal ? imageHeight : 'auto'"
    /></ng-template>
  </div>
</ng-container>
<!-- ----------------------------------- -->
<!-- QUOTE -->
<!-- ----------------------------------- -->
<ng-container *ngIf="!hideMedia">
  <div
    *ngIf="service.isQuote$ | async"
    class="m-activityContent__quote"
    [class.m-activityContent__quote--hasText]="!!text"
  >
    <m-activityV2__quote
      [parentService]="service"
      [entity]="service.entity$ | async"
      [style.height]="quoteHeight"
      [style.max-height]="quoteHeight"
    >
    </m-activityV2__quote>
  </div>
</ng-container>
<!-- ----------------------------------- -->
<!-- TEXT (WHEN TEXT ON BOTTOM)-->
<!-- ----------------------------------- -->
<ng-container *ngIf="isTextBelowMedia">
  <ng-container *ngTemplateOutlet="textTemplate"></ng-container>
</ng-container>
<!-- ----------------------------------- -->
<!-- REMIND DELETED NOTICE -->
<!-- ----------------------------------- -->
<div
  class="m-activityContent__remindDeletedNotice m-activityContent__textOjm"
  *ngIf="(service.entity$ | async).remind_deleted"
>
  <i class="material-icons">info</i>
  <span
    >This reminded content is unavailable. It may have been deleted or you do
    not have permission to view it.</span
  >
</div>
<!-- ----------------------------------- -->
<!-- PERMALINK -->
<!-- ----------------------------------- -->
<m-activityV2__permalink
  *ngIf="showPermalink"
  class="m-activityContent__permalink m-activityContent__textOjm"
></m-activityV2__permalink>
<!-- ----------------------------------- -->
<!-- TEMPLATE: TEXT-->
<!-- ----------------------------------- -->
<ng-template #textTemplate
  ><ng-container *ngIf="!hideText">
    <div class="m-activityContent__fixedHeightSpacer" *ngIf="isStatus"></div>
    <div
      #textEl
      m-read-more
      class="m-activityContent__textWrapper"
      [class.m-activityContent__textWrapper--shortStatus]="shortStatus"
      [class.m-activityContent__textWrapper--mediumStatus]="mediumStatus"
      [maxHeightAllowed]="maxHeightAllowed || maxTextHeight"
      *ngIf="bodyText?.length >= 1 || titleText?.length >= 1"
    >
      <div
        class="m-activityContentText__innerWrapper"
        [ngClass]="{
          'm-activityContentText--translated':
            service.displayOptions.showTranslation
        }"
      >
        <p
          *ngIf="titleText"
          [innerHtml]="titleText | tags"
          class="m-activityContentText__title"
          [class.m-activityContentText__title--noDescription]="!bodyText"
        ></p>
        <p
          *ngIf="bodyText && !hideBodyText"
          class="m-activityContentText__body"
          [innerHtml]="bodyText | tags | codeHighlight"
        ></p>
        <m-read-more--button
          *ngIf="
            !(service.shouldShowPaywall$ | async) || isStatus;
            else teaserFadeout
          "
          [v2]="true"
          [showOnlyFadeout]="service.displayOptions.sidebarMode"
          [redirectUrl]="getRedirectUrl()"
        ></m-read-more--button>
        <ng-template #teaserFadeout>
          <div class="m-activityContent__teaserFadeout" @fader></div
        ></ng-template>
      </div>
      <!-- ----------------------------------- -->
      <!-- TRANSLATION  -->
      <!-- ----------------------------------- -->
      <ng-container *mIfBrowser>
        <m-translate
          *ngIf="service.displayOptions.showTranslation"
          [open]="service.displayOptions.showTranslation"
          [entity]="entity"
          [translateEvent]="translateEvent"
          (onTranslate)="onTranslate($event)"
          (onTranslateError)="onTranslate($event)"
          [class.m-translate--minimalMode]="isMinimalMode"
          class="m-activityContent__textOjm"
          #translate
        ></m-translate>
      </ng-container>
    </div>
    <div class="m-activityContent__fixedHeightSpacer" *ngIf="isStatus"></div>
  </ng-container>
</ng-template>
