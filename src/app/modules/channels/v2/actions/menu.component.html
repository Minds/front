<m-dropdownMenu
  [menu]="actionsDropdown"
  [anchorPosition]="{ top: '100%', right: '0' }"
>
  <ng-content></ng-content>
</m-dropdownMenu>

<ng-template #actionsDropdown>
  <ul>
    <ng-container *ngIf="!(service.isDisabled$ | async)">
      <m-dropdownMenu__item
        *ngIf="service.isSubscribed$ | async; else subscribeOption"
        (click)="unsubscribe()"
        label="Unsubscribe"
        i18nId="@@COMMON__UNSUBSCRIBE"
      ></m-dropdownMenu__item>
      <ng-template #subscribeOption>
        <m-dropdownMenu__item
          (click)="subscribe()"
          label="Subscribe"
          i18nId="@@COMMON__SUBSCRIBE"
        >
        </m-dropdownMenu__item>
      </ng-template>
    </ng-container>

    <!-- ******** admin ******************** -->
    <ng-container *ngIf="service.isAdmin$ | async">
      <m-dropdownMenu__item
        *ngIf="service.isBanned$ | async"
        (click)="unBan()"
        label="Un-ban globally"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__UNBAN_GLOBALLY"
      >
      </m-dropdownMenu__item>
      <m-dropdownMenu__item
        (click)="viewLedger()"
        label="View Ledger"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__VIEW_LEDGER"
      >
      </m-dropdownMenu__item>
      <m-dropdownMenu__item
        (click)="viewWithdrawals()"
        label="View Withdrawals"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__VIEW_WITHDRAWALS"
      >
      </m-dropdownMenu__item>
      <m-dropdownMenu__item
        (click)="viewBoosts('newsfeed')"
        label="View Newsfeed Boosts"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__VIEW_NEWSFEED_BOOSTS"
      >
      </m-dropdownMenu__item>
      <m-dropdownMenu__item
        (click)="viewBoosts('content')"
        label="View Sidebar Boosts"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__VIEW_SIDEBAR_BOOSTS"
      >
      </m-dropdownMenu__item>
      <m-dropdownMenu__item
        (click)="viewEmail()"
        label="E-mail Address"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__VIEW_EMAIL_ADDR"
      >
      </m-dropdownMenu__item>

      <m-dropdownMenu__item
        (click)="proAdminToggle()"
        [label]="!(service.channel$ | async)?.pro ? 'Make Pro' : 'Remove Pro'"
      >
      </m-dropdownMenu__item>

      <m-dropdownMenu__item
        (click)="plusAdminToggle()"
        *ngIf="!(service.channel$ | async)?.pro"
        [label]="
          !(service.channel$ | async)?.plus ? 'Make Plus' : 'Remove Plus'
        "
      >
      </m-dropdownMenu__item>

      <ng-container *ngIf="service.isExplicit$ | async">
        <m-dropdownMenu__item
          (click)="setExplicit(false)"
          label="Remove explicit"
          i18nId="@@MINDS_BUTTON__USER_DROPDOWN__REMOVE_EXPLICIT"
        >
        </m-dropdownMenu__item>
      </ng-container>

      <m-nsfw-selector
        (click)="$event.preventDefault(); $event.stopPropagation()"
        service="editing"
        [selected]="service.nsfw$ | async"
        (selectedChange)="setNSFWLock($event)"
        v2="true"
      >
      </m-nsfw-selector>

      <m-dropdownMenu__item
        (click)="reIndex()"
        label="Reindex"
        i18nId="@@M__ACTION__REINDEX"
      >
      </m-dropdownMenu__item>
    </ng-container>

    <!-- ******** end admin ******************** -->

    <m-dropdownMenu__item
      *ngIf="service.isBlocked$ | async; else blockOption"
      (click)="unblock()"
      label="Unblock"
      i18nId="@@MINDS_BUTTON__USER_DROPDOWN__UNBLOCK"
    >
    </m-dropdownMenu__item>
    <ng-template #blockOption>
      <m-dropdownMenu__item
        (click)="block()"
        label="Block"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__BLOCK"
      >
      </m-dropdownMenu__item>
    </ng-template>

    <ng-container *ngIf="!(service.isDisabled$ | async)">
      <m-dropdownMenu__item
        (click)="report()"
        label="Report"
        i18nId="@@MINDS_BUTTON__USER_DROPDOWN__REPORT"
      >
      </m-dropdownMenu__item>
    </ng-container>
  </ul>
</ng-template>

<m-modal
  *ngIf="service.email$ | async as email"
  [open]="true"
  (closed)="service.email$.next(null)"
>
  <div
    class="mdl-card__supporting-text"
    style="padding: 64px; font-size: 20px; text-align: center"
  >
    @{{ service.username$ | async }}'s email:
    <a *ngIf="email" [href]="'mailto:' + email" style="text-decoration: none">
      {{ email }}
    </a>
    <ng-container *ngIf="!email">...</ng-container>
  </div>
</m-modal>
