<div
  *ngIf="publisher"
  class="m-publisherCard"
  #publisherCard
  [ngClass]="{
    'm-publisherCard--large': size === 'large',
    'm-publisherCard--medium': size === 'medium',
    'm-publisherCard--small': size === 'small',
    'm-publisherCard--featured': featured,
    'm-publisherCard--hovercard': _isHovercard,
    'm-publisherCard--noBorder': noBorder,
    'm-publisherCard--noPadding': noPadding
  }"
>
  <section class="m-publisherCard__inner m-publisherCard__flexRow">
    <ng-container *ngIf="size === 'medium' || size === 'large'">
      <ng-container *ngTemplateOutlet="avatar"></ng-container>

      <div class="m-publisherCard__flexColumn m-publisherCard__stretch">
        <ng-container *ngTemplateOutlet="primaryRow"></ng-container>
        <ng-container *ngTemplateOutlet="secondaryRow"></ng-container>
        <ng-container *ngTemplateOutlet="description"></ng-container>
        <ng-container *ngTemplateOutlet="boostedFlag"></ng-container>
      </div>
      <div
        *ngIf="showButton"
        class="m-publisherCard__buttonContainer"
        [ngClass]="{
          'm-publisherCard__buttonContainer--iconOnly': buttonIconOnly
        }"
      >
        <ng-container *ngTemplateOutlet="button"></ng-container>
      </div>
    </ng-container>
    <!-- ------------------------------------------------- -->
    <ng-container *ngIf="size === 'small'">
      <div class="m-publisherCard__flexColumn">
        <div class="m-publisherCard__flexRow">
          <ng-container *ngTemplateOutlet="avatar"></ng-container>
          <div class="m-publisherCard__flexColumn m-publisherCard__stretch">
            <ng-container *ngTemplateOutlet="primaryRow"></ng-container>
            <ng-container *ngTemplateOutlet="secondaryRow"></ng-container>
          </div>
          <ng-container [ngTemplateOutlet]="button"></ng-container>
        </div>
        <ng-container *ngTemplateOutlet="description"></ng-container>
        <ng-container *ngTemplateOutlet="boostedFlag"></ng-container>
      </div>
    </ng-container>
    <!-- ------------------------------------------------- -->
    <ng-container *ngIf="size === 'xsmall'">
      <div class="m-publisherCard__flexColumn">
        <ng-container *ngTemplateOutlet="avatar"></ng-container>
        <ng-container *ngTemplateOutlet="primaryRow"></ng-container>
        <ng-container *ngTemplateOutlet="secondaryRow"></ng-container>
        <div class="m-publisherCard__flexColumn"></div>
        <ng-container [ngTemplateOutlet]="button"></ng-container>
      </div>
    </ng-container>
  </section>
</div>
<!------------------------------>
<!--\/\/\/\/\/\/\/\/\/\/\/\/\/-->
<!-- TEMPLATES  -->
<!--\/\/\/\/\/\/\/\/\/\/\/\/\/-->
<!------------------------------>

<!------------------------------>
<!-- AVATAR  -->
<!------------------------------>
<ng-template #avatar>
  <a
    [routerLink]="feedUrl"
    class="m-publisherCard__avatarContainer"
    [ngClass]="{
      'm-publisherCardAvatar--hasMarker': publisher.hasMarker
    }"
  >
    <m-hovercard [publisher]="publisher" [offset]="[0, 15]">
      <minds-avatar [object]="publisher" [editMode]="false"></minds-avatar>
    </m-hovercard>
  </a>
</ng-template>

<!------------------------------>
<!-- PRIMARY ROW: NAME  -->
<!------------------------------>
<ng-template #primaryRow>
  <a [routerLink]="feedUrl" class="m-publisherCard__primaryRow">
    <span>{{ publisher.name }}</span>
    <m-accountQualityScore [targetUser]="publisher"></m-accountQualityScore>
    <m-channel--badges
      *ngIf="type === 'user'"
      class="m-channel--badges-activity m-activityOwnerBlockPrimaryName__badges"
      [user]="publisher"
      [badges]="['admin', 'verified', 'plus', 'pro']"
    ></m-channel--badges>
  </a>
</ng-template>

<!---------------------------------------------->
<!-- SECONDARY ROW -->
<!-- Groups: member count -->
<!-- Users: if not subscriber count, username -->
<!---------------------------------------------->
<ng-template #secondaryRow>
  <!-- GROUPS- MEMBER COUNT -->
  <a
    *ngIf="type === 'group'"
    class="m-publisherCard__secondaryRow m-legible"
    [routerLink]="subscribersUrl"
  >
    <span class="m-publisherCard__subscribersCount">{{
      publisher['members:count'] | abbr: 0
    }}</span>
    <span>
      member<ng-container *ngIf="publisher['members:count'] > 1"
        >s</ng-container
      >
    </span>
  </a>
  <!-- USERS - SUBSCRIBER COUNT -->
  <ng-container *ngIf="type === 'user'">
    <ng-container *ngIf="publisher.subscribers_count">
      <a
        class="m-publisherCard__secondaryRow m-legible"
        [routerLink]="subscribersUrl"
      >
        <span class="m-publisherCard__subscribersCount">{{
          publisher.subscribers_count | abbr: 0
        }}</span>
        <span>
          subscriber<ng-container *ngIf="publisher.subscribers_count > 1"
            >s</ng-container
          >
        </span>
      </a>
    </ng-container>
    <!-- USERS - @USERNAME -->
    <ng-container *ngIf="!publisher.subscribers_count">
      <a
        class="m-publisherCard__secondaryRow m-legible"
        [routerLink]="['/', publisher.username]"
      >
        <span>@{{ publisher.username }}</span>
      </a>
    </ng-container>
  </ng-container>
</ng-template>

<!------------------------------>
<!-- DESCRIPTION  -->
<!------------------------------>
<ng-template #description>
  <span
    class="m-publisherCard__description"
    [innerHtml]="publisher.briefdescription | slice: 0:5000 | tags"
  ></span>
</ng-template>

<!------------------------------>
<!-- BOOSTED FLAG  -->
<!------------------------------>
<ng-template #boostedFlag>
  <m-boostedFlag
    *ngIf="showBoostedFlag && publisher.boosted"
    [text]="publisher.type === 'user' ? 'Boosted Channel' : 'Boosted Group'"
    size="small"
  ></m-boostedFlag
></ng-template>

<!------------------------------>
<!-- BUTTON  -->
<!------------------------------>
<ng-template #button>
  <ng-container *ngIf="showButton">
    <m-subscribeButton
      *ngIf="publisher.type === 'user'"
      [user]="publisher"
      [sized]="sized"
      [iconOnly]="buttonIconOnly || subscribeButtonIconOnly"
      [subscribedIcon]="
        buttonIconOnly || subscribeButtonIconOnly ? subscribedIcon : null
      "
      [disableSubscribe]="disableSubscribe"
      [enableRecheck]="recheckSubscribed"
      (subscribed)="onSubscribed($event)"
      (unsubscribed)="onUnsubscribed($event)"
    ></m-subscribeButton>
    <m-group__membershipButton
      *ngIf="publisher.type === 'group'"
      [group]="publisher"
      [iconOnly]="buttonIconOnly"
      [color]="membershipButtonColor"
      [size]="membershipButtonSize"
      [isMemberIcon]="isMemberIcon"
      labelType="pastTense"
      (onMembershipChange)="onGroupMembershipChange($event, publisher)"
    ></m-group__membershipButton>
  </ng-container>
</ng-template>
